package com.paule.kitprod_api.controller;

import com.paule.kitprod_api.model.Exploitation;
import com.paule.kitprod_api.repository.ExploitationRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.ArrayList;
import java.util.Collections;
import java.util.List;
import java.util.UUID;

@CrossOrigin(origins = "*", maxAge = 3600)
@RestController
public class ExploitationController {

    @Autowired
    public ExploitationRepository exploitationRepository;

    @GetMapping(value = "/exploitations")
    public List<Exploitation> getExploitationByUser(@RequestParam String idUser) {
        ArrayList<Exploitation> exploitations = new ArrayList<>();
        Exploitation existingExploitation = exploitationRepository.getExploitationByUser(idUser);
        if (existingExploitation == null) {
            return Collections.emptyList();
        }
        exploitations.add(existingExploitation);
        return exploitations;
    }

    @PostMapping(value = "/exploitations")
    public Exploitation createExploitation(@RequestBody Exploitation exploitation) {
        exploitation.setId(UUID.randomUUID().toString());
        Exploitation insertedExploitation = exploitationRepository.insert(exploitation);

        return insertedExploitation;
    }

}
